<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PaniniFS - Dashboard de Gouvernance Autonome</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/gantt@0.2.0/dist/css/gantt.css" rel="stylesheet">
    <style>
        .agent-card {
            transition: transform 0.2s ease-in-out;
            border-left: 4px solid var(--bs-primary);
        }
        .agent-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        .status-active { background-color: #28a745; }
        .status-idle { background-color: #ffc107; }
        .status-error { background-color: #dc3545; }
        .workflow-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 500;
        }
        .workflow-success { background-color: #d4edda; color: #155724; }
        .workflow-failed { background-color: #f8d7da; color: #721c24; }
        .workflow-pending { background-color: #fff3cd; color: #856404; }
        .gantt-container {
            height: 400px;
            overflow-x: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
        }
        .metric-value {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .progress-ring {
            width: 120px;
            height: 120px;
        }
        .governance-flow {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 2rem;
        }
        .flow-step {
            background: white;
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        .flow-arrow {
            text-align: center;
            color: #6c757d;
            font-size: 1.5rem;
        }
        .questioning-point {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            border-radius: 10px;
            padding: 1rem;
            margin: 0.5rem 0;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .mini-timeline {
            height: 200px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
        }
        .timeline-item {
            padding: 0.5rem 0;
            border-left: 3px solid #007bff;
            padding-left: 1rem;
            margin-bottom: 1rem;
            position: relative;
        }
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -6px;
            top: 0.75rem;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #007bff;
        }
        .auto-refresh {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="auto-refresh">
        <div class="btn-group" role="group">
            <button type="button" class="btn btn-sm btn-outline-primary" onclick="location.reload()">
                <i class="fas fa-sync-alt"></i> Actualiser
            </button>
            <button type="button" class="btn btn-sm btn-outline-success" id="autoRefreshBtn">
                <i class="fas fa-play"></i> Auto (30s)
            </button>
        </div>
    </div>

    <div class="container-fluid py-4">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h1 class="display-4 mb-2">ü§ñ PaniniFS Dashboard</h1>
                        <p class="lead text-muted">Gouvernance Autonome & Orchestration Intelligente</p>
                        <div class="mt-2">
                            <a href="domains.html" class="btn btn-outline-primary btn-sm me-2">
                                üåê Gestion Domaines
                            </a>
                            <a href="https://github.com/stephanedenis/PaniniFS" class="btn btn-outline-secondary btn-sm">
                                üìÅ GitHub
                            </a>
                        </div>
                    </div>
                    <div class="text-end">
                        <div class="small text-muted">Derni√®re mise √† jour</div>
                        <div class="fw-bold" id="lastUpdate"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- M√©triques principales -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card metric-card text-center p-3">
                    <div class="metric-value" id="systemHealth">100%</div>
                    <div>Sant√© du Syst√®me</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card text-center p-3">
                    <div class="metric-value" id="activeAgents">3</div>
                    <div>Agents Actifs</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card text-center p-3">
                    <div class="metric-value" id="workflowSuccess">80%</div>
                    <div>Workflows R√©ussis</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card metric-card text-center p-3">
                    <div class="metric-value" id="autonomyCycles">42</div>
                    <div>Cycles d'Autonomie</div>
                </div>
            </div>
        </div>

        <!-- Agents et Workflows -->
        <div class="row mb-4">
            <!-- Agents Status -->
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-robot me-2"></i>√âtat des Agents</h5>
                        <span class="badge bg-success">3/3 Actifs</span>
                    </div>
                    <div class="card-body">
                        <div class="agent-card card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="card-title">
                                            <span class="status-indicator status-active"></span>
                                            Agent Copilote
                                        </h6>
                                        <p class="card-text small text-muted">
                                            Orchestration & supervision g√©n√©rale
                                        </p>
                                        <div class="small">
                                            <strong>Derni√®re activit√©:</strong> Cycle autonome (4h)
                                        </div>
                                    </div>
                                    <span class="badge bg-primary">Actif</span>
                                </div>
                            </div>
                        </div>

                        <div class="agent-card card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="card-title">
                                            <span class="status-indicator status-active"></span>
                                            Agent GitHub Monitor
                                        </h6>
                                        <p class="card-text small text-muted">
                                            Surveillance des workflows GitHub
                                        </p>
                                        <div class="small">
                                            <strong>Derni√®re activit√©:</strong> Monitoring workflows (30min)
                                        </div>
                                    </div>
                                    <span class="badge bg-success">Surveillance</span>
                                </div>
                            </div>
                        </div>

                        <div class="agent-card card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div>
                                        <h6 class="card-title">
                                            <span class="status-indicator status-active"></span>
                                            Agent Headless
                                        </h6>
                                        <p class="card-text small text-muted">
                                            Ex√©cution autonome en arri√®re-plan
                                        </p>
                                        <div class="small">
                                            <strong>Derni√®re activit√©:</strong> Traitement batch (1h)
                                        </div>
                                    </div>
                                    <span class="badge bg-info">Traitement</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Workflows Status -->
            <div class="col-lg-6">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Workflows GitHub</h5>
                        <span class="badge bg-warning">8/10 R√©ussis</span>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6 mb-3">
                                <div class="p-3 border rounded">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="small">CI/CD Principal</span>
                                        <span class="workflow-status workflow-success">‚úì R√©ussi</span>
                                    </div>
                                    <div class="small text-muted mt-1">il y a 2h</div>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="p-3 border rounded">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="small">Tests Auto</span>
                                        <span class="workflow-status workflow-success">‚úì R√©ussi</span>
                                    </div>
                                    <div class="small text-muted mt-1">il y a 1h</div>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="p-3 border rounded">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="small">Deploy Prod</span>
                                        <span class="workflow-status workflow-success">‚úì R√©ussi</span>
                                    </div>
                                    <div class="small text-muted mt-1">il y a 3h</div>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="p-3 border rounded">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span class="small">Security Scan</span>
                                        <span class="workflow-status workflow-failed">‚úó √âchec</span>
                                    </div>
                                    <div class="small text-muted mt-1">il y a 4h</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <h6 class="small text-muted mb-2">Progression des workflows</h6>
                            <div class="progress mb-2" style="height: 8px;">
                                <div class="progress-bar bg-success" style="width: 80%"></div>
                            </div>
                            <div class="d-flex justify-content-between small text-muted">
                                <span>8 r√©ussis</span>
                                <span>2 √©checs</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gantt Chart des Chantiers -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-project-diagram me-2"></i>Diagramme de Gantt - Chantiers en Cours</h5>
                    </div>
                    <div class="card-body">
                        <div class="gantt-container" id="ganttChart">
                            <svg width="100%" height="400" id="ganttSvg">
                                <!-- Gantt chart sera g√©n√©r√© ici -->
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Flux de Gouvernance Strat√©gique -->
        <div class="row mb-4">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-sitemap me-2"></i>Flux de Gouvernance Strat√©gique</h5>
                    </div>
                    <div class="card-body governance-flow">
                        <div class="flow-step">
                            <h6><i class="fas fa-search text-primary me-2"></i>1. Analyse & D√©tection</h6>
                            <p class="mb-0 small">Surveillance continue des workflows, d√©tection d'anomalies et analyse des patterns</p>
                        </div>
                        <div class="flow-arrow">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                        <div class="flow-step">
                            <h6><i class="fas fa-brain text-success me-2"></i>2. Prise de D√©cision Autonome</h6>
                            <p class="mb-0 small">IA √©value les options, priorise les actions selon les r√®gles de gouvernance</p>
                        </div>
                        <div class="flow-arrow">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                        <div class="flow-step">
                            <h6><i class="fas fa-cogs text-warning me-2"></i>3. Ex√©cution Coordonn√©e</h6>
                            <p class="mb-0 small">Orchestration des agents, d√©ploiement des actions, monitoring en temps r√©el</p>
                        </div>
                        <div class="flow-arrow">
                            <i class="fas fa-arrow-down"></i>
                        </div>
                        <div class="flow-step">
                            <h6><i class="fas fa-chart-line text-info me-2"></i>4. Validation & Apprentissage</h6>
                            <p class="mb-0 small">V√©rification des r√©sultats, feedback loop, am√©lioration continue</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Points de Questionnement -->
            <div class="col-lg-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-question-circle me-2"></i>Points de Questionnement</h5>
                    </div>
                    <div class="card-body">
                        <div class="questioning-point">
                            <h6><i class="fas fa-exclamation-triangle me-2"></i>Optimisation Workflows</h6>
                            <p class="mb-0 small">Dois-je optimiser la strat√©gie de retry pour les workflows qui √©chouent ?</p>
                        </div>
                        
                        <div class="questioning-point">
                            <h6><i class="fas fa-database me-2"></i>Gestion Ressources</h6>
                            <p class="mb-0 small">Les ressources cloud sont-elles optimalement allou√©es pour les prochains cycles ?</p>
                        </div>
                        
                        <div class="questioning-point">
                            <h6><i class="fas fa-shield-alt me-2"></i>S√©curit√©</h6>
                            <p class="mb-0 small">Faut-il renforcer les contr√¥les de s√©curit√© suite aux derni√®res analyses ?</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Timeline et Logs -->
        <div class="row">
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-history me-2"></i>Timeline d'Activit√©</h5>
                    </div>
                    <div class="card-body">
                        <div class="mini-timeline" id="activityTimeline">
                            <div class="timeline-item">
                                <div class="fw-bold small">Cycle autonome d√©marr√©</div>
                                <div class="text-muted small">Il y a 4 heures</div>
                                <div class="small">Agent Copilote a initi√© un nouveau cycle d'analyse</div>
                            </div>
                            <div class="timeline-item">
                                <div class="fw-bold small">Workflow CI/CD r√©ussi</div>
                                <div class="text-muted small">Il y a 2 heures</div>
                                <div class="small">D√©ploiement automatique effectu√© avec succ√®s</div>
                            </div>
                            <div class="timeline-item">
                                <div class="fw-bold small">Monitoring GitHub</div>
                                <div class="text-muted small">Il y a 30 minutes</div>
                                <div class="small">Agent GitHub Monitor a analys√© 8 workflows</div>
                            </div>
                            <div class="timeline-item">
                                <div class="fw-bold small">Optimisation d√©tect√©e</div>
                                <div class="text-muted small">Il y a 15 minutes</div>
                                <div class="small">Proposition d'am√©lioration des performances</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>R√©partition des T√¢ches</h5>
                    </div>
                    <div class="card-body text-center">
                        <canvas id="taskDistributionChart" width="300" height="300"></canvas>
                        <div class="mt-3">
                            <div class="row text-center">
                                <div class="col-4">
                                    <div class="small text-muted">Monitoring</div>
                                    <div class="fw-bold text-primary">45%</div>
                                </div>
                                <div class="col-4">
                                    <div class="small text-muted">Ex√©cution</div>
                                    <div class="fw-bold text-success">35%</div>
                                </div>
                                <div class="col-4">
                                    <div class="small text-muted">Analyse</div>
                                    <div class="fw-bold text-warning">20%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Mise √† jour de l'heure
        function updateTime() {
            const now = new Date();
            document.getElementById('lastUpdate').textContent = now.toLocaleString('fr-FR');
        }
        updateTime();

        // Auto-refresh
        let autoRefreshInterval;
        let isAutoRefreshActive = false;
        
        document.getElementById('autoRefreshBtn').addEventListener('click', function() {
            if (isAutoRefreshActive) {
                clearInterval(autoRefreshInterval);
                this.innerHTML = '<i class="fas fa-play"></i> Auto (30s)';
                this.classList.remove('btn-outline-danger');
                this.classList.add('btn-outline-success');
                isAutoRefreshActive = false;
            } else {
                autoRefreshInterval = setInterval(() => {
                    updateTime();
                    // Ici on pourrait faire des appels AJAX pour mettre √† jour les donn√©es
                    console.log('Auto-refresh des donn√©es...');
                }, 30000);
                this.innerHTML = '<i class="fas fa-stop"></i> Stop Auto';
                this.classList.remove('btn-outline-success');
                this.classList.add('btn-outline-danger');
                isAutoRefreshActive = true;
            }
        });

        // Gantt Chart simple
        function createSimpleGantt() {
            const svg = document.getElementById('ganttSvg');
            const width = svg.clientWidth;
            const height = 400;
            
            // Donn√©es des t√¢ches
            const tasks = [
                {name: 'Am√©lioration Workflows', start: 0, duration: 30, color: '#007bff'},
                {name: 'Optimisation Agents', start: 10, duration: 25, color: '#28a745'},
                {name: 'Mise √† jour S√©curit√©', start: 20, duration: 20, color: '#ffc107'},
                {name: 'Documentation', start: 35, duration: 15, color: '#6f42c1'},
                {name: 'Tests & Validation', start: 45, duration: 10, color: '#fd7e14'}
            ];
            
            const barHeight = 40;
            const spacing = 10;
            const scale = (width - 200) / 60; // 60 jours max
            
            svg.innerHTML = '';
            
            tasks.forEach((task, index) => {
                const y = index * (barHeight + spacing) + 50;
                const x = 150 + task.start * scale;
                const width_bar = task.duration * scale;
                
                // Nom de la t√¢che
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', 10);
                text.setAttribute('y', y + barHeight/2 + 5);
                text.setAttribute('font-size', '12');
                text.setAttribute('fill', '#333');
                text.textContent = task.name;
                svg.appendChild(text);
                
                // Barre de progression
                const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                rect.setAttribute('x', x);
                rect.setAttribute('y', y);
                rect.setAttribute('width', width_bar);
                rect.setAttribute('height', barHeight);
                rect.setAttribute('fill', task.color);
                rect.setAttribute('rx', 5);
                svg.appendChild(rect);
                
                // Texte de dur√©e
                const durationText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                durationText.setAttribute('x', x + width_bar/2);
                durationText.setAttribute('y', y + barHeight/2 + 5);
                durationText.setAttribute('font-size', '10');
                durationText.setAttribute('fill', 'white');
                durationText.setAttribute('text-anchor', 'middle');
                durationText.textContent = task.duration + 'j';
                svg.appendChild(durationText);
            });
        }
        
        // Chart en camembert pour la r√©partition des t√¢ches
        function createTaskDistributionChart() {
            const ctx = document.getElementById('taskDistributionChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Monitoring', 'Ex√©cution', 'Analyse'],
                    datasets: [{
                        data: [45, 35, 20],
                        backgroundColor: ['#007bff', '#28a745', '#ffc107'],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }

        // Simulation de donn√©es en temps r√©el
        function simulateRealtimeData() {
            // Mise √† jour al√©atoire des m√©triques
            const systemHealth = Math.floor(Math.random() * 10) + 90;
            const workflowSuccess = Math.floor(Math.random() * 20) + 70;
            const cycles = Math.floor(Math.random() * 5) + 40;
            
            document.getElementById('systemHealth').textContent = systemHealth + '%';
            document.getElementById('workflowSuccess').textContent = workflowSuccess + '%';
            document.getElementById('autonomyCycles').textContent = cycles;
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            createSimpleGantt();
            createTaskDistributionChart();
            
            // Simulation de donn√©es toutes les minutes
            setInterval(simulateRealtimeData, 60000);
        });
    </script>
</body>
</html>
